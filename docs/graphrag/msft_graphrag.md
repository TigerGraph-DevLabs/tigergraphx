# Supporting Microsoft’s GraphRAG

[Microsoft's GraphRAG](https://microsoft.github.io/graphrag/) is a method for creating structured knowledge graphs from raw text, enhancing Retrieval Augmented Generation (RAG) tasks. By organizing information hierarchically, it enables more efficient data retrieval and summarization.

This guide demonstrates how to integrate **GraphRAG** with **TigerGraph** using **TigerGraphX**, transforming documents into structured data, importing them into TigerGraph, and enabling complex queries without relying on the GraphRAG package.

---

## Prerequisites

Before proceeding, ensure you’ve completed the installation and setup steps outlined in the [Installation Guide](../getting_started/installation.md), including:

- Installing TigerGraphX with development dependencies.

- Setting up TigerGraph and ensuring API tokens are configured.

---

## 1. Indexing

The indexing process transforms raw documents into structured data using Microsoft’s GraphRAG. Follow these steps to prepare your data:

### 1.1 Data Preparation

#### Create an Input Folder
Create an `input` folder in the `data` directory under `applications/msft_graphrag` to store the documents you want to index. You can specify a different directory by replacing `data` with your desired path.

```bash
mkdir -p data/input
```

#### Add Documents to the Input Folder
Copy your documents (e.g., `fin.txt`) into the `data/input` folder.

---

### 1.2 Initialization

Initialize the indexing system in the `data` directory.

```bash
python3 -m graphrag init --root data
```

---

### 1.3 Set Up OpenAI API Key

GraphRAG requires an OpenAI API key. To configure it:

1. Open the `.env` file in the `data` directory:
   ```bash
   vi data/.env
   ```
2. Add your API key:
   ```bash
   GRAPHRAG_API_KEY=<Your OpenAI API Key>
   ```

#### Optional: Switch to a Cost-Effective Model
GraphRAG uses the `gpt-4-turbo-preview` model by default. To reduce costs, switch to the `gpt-4o-mini` model by editing the `settings.yaml` file in the `data` directory:

```yaml
llm:
  api_key: ${GRAPHRAG_API_KEY}
  type: openai_chat # or azure_openai_chat
  model: gpt-4o-mini # Use a cost-effective model
```

---

### 1.4 Indexing

Run the indexing process to convert documents into structured data. This step uses LLMs and may take several minutes depending on the dataset size and hardware.

```bash
python3 -m graphrag index --no-cache --root data
```

---

## 2. Data Preprocessing

Transform the structured Parquet files generated by GraphRAG into CSV files that TigerGraph can import.

### 2.1 Convert Parquet to CSV

Run the following script to convert Parquet files into TigerGraph-compatible CSV files:

```bash
python3 data_import/convert_parquet_to_tg_csv.py \
--input_dir data/output \
--output_dir data/tg_csv
```

### 2.2 Transfer CSV Files to TigerGraph Server

Transfer the generated CSV files to your TigerGraph server. Use the following command, replacing `username` and `tigergraph-server` with your server credentials:

```bash
scp data/tg_csv/* username@tigergraph-server:/home/tigergraph/data/graphrag
```

---

## 3. Query

Once the data is imported, you can query it using the `poe graphrag` command. Adjust the mode and query to fit your needs.

### Example 1: Query with Data Loading

The first query should include the `--to_load_data` flag to load the data into TigerGraph.

```bash
poe graphrag --mode local --query "What are the recent developments or products of CytoSorb mentioned in the article?" --to_load_data
```

### Example 2: Query Without Data Loading

Subsequent queries can omit the `--to_load_data` flag for faster execution.

```bash
poe graphrag --mode global --query "What are the key topics discussed in the article?"
```

---

## Learn More

- [GraphRAG Overview](overview.md): Understand the fundamentals of GraphRAG and how TigerGraph supports it.
- [Why TigerGraph](why_tigergraph.md): Explore TigerGraph's unique capabilities for GraphRAG workflows.
- [Installation Guide](../getting_started/installation.md): Ensure your environment is correctly set up.
- [API Reference](../reference/api.md): Dive into TigerGraphX’s Python-native APIs.

---

By combining Microsoft’s GraphRAG and TigerGraph’s capabilities, you can unlock new possibilities for data retrieval, summarization, and advanced querying. Start building today!
